<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="yes" name="apple-mobile-web-app-capable"/>
    <meta content="yes" name="apple-touch-fullscreen"/>
    <meta content="telephone=no,email=no" name="format-detection"/>
    <meta name="App-Config" content="fullscreen=yes,useHistoryState=yes,transition=yes"/>
    <meta name="msapplication-tap-hightlight" content="no">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link href="css/mui.min.css" rel="stylesheet"/>
    <link href="css/style.css?v=1" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/rem.js"></script>
    <script src="js/mui.min.js"></script>
    <script type="text/javascript">
    	mui.init({
			beforeback: function(){
				//获得列表界面的webview
				var list = plus.webview.getWebviewById('fx.html');
				//触发列表界面的自定义事件（refresh）,从而进行数据刷新
				mui.fire(list,'refresh');
				//返回true，继续页面关闭逻辑
				return true;
			}
		})
    </script>
</head>
<body class="fixed-padding1" style="background: #f0f0f0">
<div class="header fixed-header">
    <div class="top-head edit">
        <!--<a href="javascript:void(0)" class="" onclick="goBack()"><i class="icon icon-5"></i></a>-->
        <a href="javascript:void(0)" class="mui-action-back"><i class="icon icon-5"></i></a>
        <span>门店商品进销存</span>
        <a href="javascript:void(0)" id="filter" onclick="showModal()"><i class="icon icon-8"></i></a>
    </div>
</div>
<div class="wrap analyse">
	<div id="slider" class="mui-slider">
	    	<div class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted bg-white" id="segmented">
	            <div class="mui-scroll bg-white">
	                <a class="mui-control-item mui-active" href="#item1mobile">
	                    	销售额
	                </a>
	                <a class="mui-control-item" href="#item2mobile">
	                    	毛利率
	                </a>
	                <a class="mui-control-item" href="#item3mobile">
	                    	耗损金额
	                </a>
	    		</div>
			</div>
            <div class="mui-slider-group" style="margin-top: 10px;">
                <div id="item1mobile" class="mui-slider-item mui-control-content mui-active border-n">
				    <div class="section-item mb-10 bg-white" id="lisdCard4">
				        <div class="tab-item" style="display: block;overflow:hidden;">
				            <div class="char-line1" id="tCanvas1" style="margin-top: 10px;"></div>
				            <div class="item-bottom mg-10 border-table">
				            	<p><em>当日：5989.1(万元)</em><em>同比：5.7%<i class="icon-at"></i></em></p>
					            <table class="base-table">
					                <!--<tr>
					                	<th>区域-门店</th>
					                	<th>柜组名称</th>
					                	<th>月份</th>
					                	<th>商品名称</th>
					                </tr>
					                <tr>
					                	<td><a href="###"><i class="icon-arrow"></i>三明区</a></td>
					                	<td></td>
					                	<td></td>
					                	<td></td>
					                </tr>
					                <tr>
					                	<td><a href="###"><i class="icon-arrow"></i>三明区</a></td>
					                	<td></td>
					                	<td></td>
					                	<td></td>
					                </tr>
					                <tr>
					                	<td><a href="###"><i class="icon-arrow"></i>三明区</a></td>
					                	<td></td>
					                	<td></td>
					                	<td></td>
					                </tr>
					                <tr>
					                	<td><a href="###"><i class="icon-arrow"></i>三明区</a></td>
					                	<td></td>
					                	<td></td>
					                	<td></td>
					                </tr>
					                <tr>
					                	<td><a href="###"><i class="icon-arrow"></i>三明区</a></td>
					                	<td></td>
					                	<td></td>
					                	<td></td>
					                </tr>-->
					            </table>
				        	</div>
				        </div>
				    </div>
                </div>
                <div id="item2mobile" class="mui-slider-item mui-control-content border-n">
                  	 <div class="section-item mb-10 bg-white" id="lisdCard4">
				        <div class="tab-item" style="display: block;overflow:hidden;">
				            <div class="char-line1" id="tCanvas2" style="margin-top: 10px;"></div>
				            <div class="item-bottom mg-10 border-table">
				            	<p><em>当日：5989.1(万元)</em><em>同比：5.7%<i class="icon-at"></i></em></p>
					            <table class="base-table">
					                <!--<tr>
					                	<th>区域-门店</th>
					                	<th>柜组名称</th>
					                	<th>月份</th>
					                	<th>商品名称</th>
					                </tr>
					                <tr>
					                	<td><a href="###"><i class="icon-arrow"></i>三明区</a></td>
					                	<td></td>
					                	<td></td>
					                	<td></td>
					                </tr>
					                <tr>
					                	<td><a href="###"><i class="icon-arrow"></i>三明区</a></td>
					                	<td></td>
					                	<td></td>
					                	<td></td>
					                </tr>
					                <tr>
					                	<td><a href="###"><i class="icon-arrow"></i>三明区</a></td>
					                	<td></td>
					                	<td></td>
					                	<td></td>
					                </tr>
					                <tr>
					                	<td><a href="###"><i class="icon-arrow"></i>三明区</a></td>
					                	<td></td>
					                	<td></td>
					                	<td></td>
					                </tr>
					                <tr>
					                	<td><a href="###"><i class="icon-arrow"></i>三明区</a></td>
					                	<td></td>
					                	<td></td>
					                	<td></td>
					                </tr>-->
					            </table>
				        	</div>
				        </div>
				    </div>
                </div>
                <div id="item3mobile" class="mui-slider-item mui-control-content border-n">
				    <div class="section-item mb-10 bg-white" id="lisdCard4">
				        <div class="tab-item" style="display: block;overflow:hidden;">
				            <div class="char-line1" id="tCanvas3" style="margin-top: 10px;"></div>
				            <div class="item-bottom mg-10 border-table">
				            	<p><em>当日：5989.1(万元)</em><em>同比：5.7%<i class="icon-at"></i></em></p>
					            <table class="base-table">
					                <!--<tr>
					                	<th>区域-门店</th>
					                	<th>柜组名称</th>
					                	<th>月份</th>
					                	<th>商品名称</th>
					                </tr>
					                <tr>
					                	<td><a href="###"><i class="icon-arrow"></i>三明区</a></td>
					                	<td></td>
					                	<td></td>
					                	<td></td>
					                </tr>
					                <tr>
					                	<td><a href="###"><i class="icon-arrow"></i>三明区</a></td>
					                	<td></td>
					                	<td></td>
					                	<td></td>
					                </tr>
					                <tr>
					                	<td><a href="###"><i class="icon-arrow"></i>三明区</a></td>
					                	<td></td>
					                	<td></td>
					                	<td></td>
					                </tr>
					                <tr>
					                	<td><a href="###"><i class="icon-arrow"></i>三明区</a></td>
					                	<td></td>
					                	<td></td>
					                	<td></td>
					                </tr>
					                <tr>
					                	<td><a href="###"><i class="icon-arrow"></i>三明区</a></td>
					                	<td></td>
					                	<td></td>
					                	<td></td>
					                </tr>-->
					            </table>
				        	</div>
				        </div>
				    </div>
                </div>
            </div>
    </div>
</div>

<div class="tip-alert">
	<div class="tip-cover"></div>
	<div class="tip-info">
		<div class="tip-title">指标说明</div>
		<div class="tip-body">
			<p><span>销售额</span><em>销售金额</em></p>
			<p><span>客流</span><em>进店客户人数</em></p>
			<p><span>客单</span><em>客单=销售额/客流</em></p>
			<p><span>去年同期</span><em>去年同时期段数据</em></p>
			<p><span>VS去年同期</span><em>本周同期统计数据与去年同期相比较</em></p>
		</div>
		<div class="tip-foot">
			<a href="####" class="tip-btn">确定</a>
		</div>
	</div>
</div>			        	
<div class="more-alert" style="display: none">
    <div class="alert-body">
        <ul>
            <li>
                <a href="###">
                    <p><i class="menu-add"></i></p>
                    <p>加到组合</p>
                </a>
            </li>
        </ul>
    </div>
    <div class="alert-foot text-center">
        <a href="javascript:void(0)" id="closeAlert">取消</a>
    </div>
</div>

<div id="modal" style="background: #fff;display: none;position: fixed;left: 0;bottom:0;width: 100%;height: 100%;z-index: 999;">
	<form id="modalForm">
		<div class="select-item pd-10">
			<div class="select-title"><em class="fr">全部门店<i class="icon-ar1"></i></em><span>选择门店</span></div>
			<ul class="list-item" id="jx_1">
				<li><label><input type="radio" name="radio1" class="shopId"><a class="item-btn active" shopId="">黎明店</a></label></li>
				<li><label><input type="radio" name="radio1" class="shopId"><a class="item-btn" shopId="">杨桥店</a></label></li>
				<li><label><input type="radio" name="radio1" class="shopId"><a class="item-btn" shopId="">宝龙店</a></label></li>
			</ul>
		</div>
		<div class="select-item pd-10">
			<div class="select-title"><em class="fr">全部柜组<i class="icon-ar1"></i></em><span>选择柜组</span></div>
			<ul class="list-item" id="jx_2">
				<li><label><input type="radio" name="radio2" class="cupboardGroup"><a class="item-btn" cupboardGroup="">生鲜柜</a></label></li>
				<li><label><input type="radio" name="radio2" class="cupboardGroup"><a class="item-btn" cupboardGroup="">食品柜</a></label></li>
				<li><label><input type="radio" name="radio2" class="cupboardGroup"><a class="item-btn" cupboardGroup="">百货柜</a></label></li>
			</ul>
		</div>
		<!--<div class="select-item pd-10">
			<div class="select-title"><em class="fr">全部课<i class="icon-ar1"></i></em><span>选择课</span></div>
			<ul class="list-item" id="jx_3">
				<li><label><input type="radio" name="radio3" class="courseGroup"><a href="###" class="item-btn" courseGroup="">生鲜课</label></a></li>
				<li><label><input type="radio" name="radio3" class="courseGroup"><a href="###" class="item-btn" courseGroup="">蔬菜课</label></a></li>
				<li><label><input type="radio" name="radio3" class="courseGroup"><a href="###" class="item-btn" courseGroup="">肉课</label></a></li>
			</ul>
		</div>-->
		<div class="select-item pd-10">
			<div class="select-title"><span>商品检索</span><input type="text" class="any-input" placeholder="编码/名称"/></div>
		</div>
		<div class="select-time">
			<p class="set-time">设置时间</p>
			<p class="mt-3">
				<input type="date" placeholder="2016-01-01" onfocus="(this.type='date')" class="input-date" id="beginDate"><em>-</em>
				<input type="date" placeholder="2016-01-01" onfocus="(this.type='date')" class="input-date" id="selectDate"><em>-</em>
				<!--<input type="date" placeholder="2016-01-01" onfocus="(this.type='date')" class="input-date" >-->
				<select class="input-date" id="dateType">
					<option value="a">上半月</option>
					<option value="b">下半月</option>
					<option value="c">全月</option>
				</select>
			</p>
		</div>
		<div class="bottom-btn">
			<a href="###" class="reset-btn">重置</a>
			<a href="javascript:void(0)" class="confirm-btn">确定</a>
		</div>
	</form>
</div>
</body>
<script src="js/echart/echarts.js"></script>
<script src="js/ajax2.js"></script>
<script type="text/javascript">
		var dataParam={
			body:{
				userId:"",
		        shopId:"1",
		        cabinetId:"",
		        cateId:"",
		        selectDate:"2017-08-01",
		        monthType:"a",
		        goodsId:"",
		        page:"1",
		        counts:"20"
		    }
		};
		$.ajax('http://jaaint.f3322.net:28080/SQBusiness/goodsController/selectSingleJXCApp',{
			data: JSON.stringify(dataParam),
			dataType:'json',//服务器返回json格式数据
			crossDomain:true,
			type:'post',//HTTP请求类型
			contentType: "application/json; charset=utf-8",
			timeout:10000,//超时时间设置为10秒；
			headers:{'Content-Type':'application/json'},	              
			success:function(data){
			//服务器返回响应，根据响应结果，分析是否登录成功；
			var sale_value = data.body.data.singleTrendMap;
			//上周销售额
			var sale1 = [];
			//本周销售额
			var sale2 = [];
			//设空数组
			var sale3 = [];
			for(var i=0;i<sale_value.length;i++){
				sale1.push(parseFloat(sale_value[i].SaleValue).toFixed(2));				
			}			
			sale1.unshift(0);
			echartLine4('tCanvas1',sale1,sale2);
			//上周利率
			var profit1 = [];
			//本周利率
			var profit2 = [];
			for(var i = 0;i<sale_value.length;i++){
				profit1.push(parseFloat(sale_value[i].ProfitRate).toFixed(2))
			}
			profit1.unshift(0);
			echartLine4('tCanvas2',profit1,profit2);
			//上周损耗金额
			var outValue1 = [];
			//本周损耗金额
			var outValue2 = [];
			for(var i = 0;i<sale_value.length;i++){
				outValue1.push(parseFloat(sale_value[i].UnOutValue).toFixed(2))
			}
			outValue1.unshift(0);
			echartLine4('tCanvas3',outValue1,outValue2);
			window.onresize=function(){
//				echartLine('tCanvas1');
//				echartLine('tCanvas2');
//				echartLine('tCanvas3');		
			};
			var shop_data = data.body.data.singleDetailData;
			var shop_ml = '<tr><th>区域-门店</th><th>柜组名称</th><th>商品名称</th><th>期初金额</th><th>期末金额</th><th>损耗率</th><th>毛利额</th></tr>';
			for(var i=0;i<shop_data.length;i++){
				shop_ml+= '<tr><td><a href="###">'+shop_data[i].ShopName+'</a></td>';		
				shop_ml+= '<td>'+shop_data[i].GroupName+'</td>';		
				shop_ml+= '<td>'+shop_data[i].GoodsName+'</td>';		
				shop_ml+= '<td>'+parseFloat(shop_data[i].StkFV).toFixed(2)+'</td>';
				shop_ml+= '<td>'+parseFloat(shop_data[i].StkEV).toFixed(2)+'</td>';
				shop_ml+= '<td>'+parseFloat(shop_data[i].UnOutQtyRate).toFixed(2)+'</td>';
				shop_ml+= '<td>'+parseFloat(shop_data[i].Profit).toFixed(2)+'</td></tr>';
			}
			$('.base-table').html(shop_ml);
		},
		error:function(xhr,type,errorThrown){
			//异常处理；
			console.log(errorThrown);
		}
	 });
	
	function goBack(){
		window.webkit.messageHandlers.NativeMethod.postMessage("我要调用native的方法");
	}	
	function showModal(){
		jQuery("#modal").slideDown(500);
		arr=[];		
	}	
	jQuery(".confirm-btn").click(function(){		
		if(arr1){
			arr.push(arr1);
		}
		if(arr2){
			arr.push(arr2);
		}		
		var arr5 = $('.select-title input[type=text]').val();
		if(arr5){
			arr.push(arr5);
		}
		var dataParam1={
			body:{
					userId:"",
			        shopId:"1",
			        cabinetId:"",
			        cateId:"",
			        selectDate:"2017-08-01",
			        monthType:"a",
			        goodsId:"",
			        page:"1",
			        counts:"20"
			    }
		};
		$.ajax('http://jaaint.f3322.net:28080/SQBusiness/goodsController/selectSingleJXCApp',{
			data: JSON.stringify(dataParam),
			dataType:'json',//服务器返回json格式数据
			crossDomain:true,
			type:'post',//HTTP请求类型
			contentType: "application/json; charset=utf-8",
			timeout:10000,//超时时间设置为10秒；
			headers:{'Content-Type':'application/json'},	              
			success:function(data){
				//console.log(data);
				var shop_data = data.body.data.singleDetailData;
				function isContained(a, b){
				    if(!(a instanceof Array) || !(b instanceof Array)) return false;
				    if(a.length < b.length) return false;
				    var aStr = a.toString();
				    for(var i = 0, len = b.length; i < len; i++){
				       if(aStr.indexOf(b[i]) == -1) return false;
				    }
				    return true;
				}
				var ar=[];
				for(var i=0;i<shop_data.length;i++){
					ar.push([shop_data[i].ShopName,shop_data[i].GroupName,shop_data[i].GoodsName,parseFloat(shop_data[i].StkFV).toFixed(2),parseFloat(shop_data[i].StkEV).toFixed(2),parseFloat(shop_data[i].UnOutQtyRate).toFixed(2),parseFloat(shop_data[i].UnOutQtyRate).toFixed(2),parseFloat(shop_data[i].Profit).toFixed(2)]);						
				}
				var select_ar = [];				
				for(var i=0;i<ar.length;i++){
					var contain = isContained(ar[i],arr);
					if(contain){
						select_ar.push(ar[i]);
						var n = ar.indexOf(ar[i]);
					}
				}
				var select_ml = '<tr><th>区域-门店</th><th>柜组名称</th><th>商品名称</th><th>期初金额</th><th>期末金额</th><th>损耗率</th><th>毛利额</th></tr>';
					for(var i=0;i<select_ar.length;i++){
						select_ml+= '<tr><td><a href="###">'+select_ar[i][0]+'</a></td>';		
						select_ml+= '<td>'+select_ar[i][1]+'</td>';		
						select_ml+= '<td>'+select_ar[i][2]+'</td>';		
						select_ml+= '<td>'+select_ar[i][3]+'</td>';
						select_ml+= '<td>'+select_ar[i][4]+'</td>';
						select_ml+= '<td>'+select_ar[i][5]+'</td>';
						select_ml+= '<td>'+select_ar[i][6]+'</td></tr>';
					}
				$('.base-table').html(select_ml);
		},
		error:function(xhr,type,errorThrown){
			//异常处理；
			console.log(errorThrown);
		}
	 });
		jQuery("#modal").slideUp(500);
	});
	var arr = [];var arr1,arr2,arr3,arr5;
	$('#jx_1 li').click(function(){		
		var k1 = $(this).text().toString();
		arr1=k1;
	});
	$('#jx_2 li').click(function(){		
		var k2 = $(this).text().toString();
		arr2=k2;
	});
	$('#jx_3 li').click(function(){		
		var k3 = $(this).text().toString();
		arr3=k3;
	});
	jQuery(".reset-btn").bind('click',function(){
		jQuery("#modalForm")[0].reset();
	})
</script>
</html>